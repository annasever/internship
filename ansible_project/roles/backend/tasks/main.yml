---
- name: 1. Update apt cache
  apt:
    update_cache: yes

- name: 1. Install Java JDK 11
  apt:
    name: openjdk-11-jdk
    state: present

- name: 2. Install Tomcat 9
  apt:
    name: tomcat9
    state: present

- name: 3. Create directory for application
  file:
    path: /usr/local/tomcat/webapps
    state: directory
    owner: tomcat
    group: tomcat

- name: 4. Ensure that Tomcat is started
  service:
    name: tomcat9
    state: started
    enabled: true

- name: 5. Copy WAR file to Tomcat
  copy:
    src: "{{ playbook_dir }}/roles/backend/files/ROOT.war"
    dest: /usr/local/tomcat/webapps/ROOT.war
    owner: tomcat
    group: tomcat
    mode: '0644'
  notify: Restart Tomcat